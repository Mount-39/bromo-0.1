$(function(){var e=function(){var e=$("#page"),a=$("<div/>",{id:"login-form"}).appendTo(e),t=$("<fieldset/>",{}).appendTo(a),o=$("<form/>",{}).appendTo(t);$("<h1/>",{text:"Bromo"}).appendTo(o),$("<p/>",{text:"Chat with your friends become more easier than ever."}).appendTo(o),$("<input/>").attr({type:"email",required:"true",placeholder:"Email",autocomplete:"off"}).appendTo(o),$("<input/>").attr({type:"password",required:"true",placeholder:"Password",autocomplete:"off"}).appendTo(o);var r=$("<input/>").attr({value:"Sign In",type:"submit"}).appendTo(o);o.submit(function(a){a.preventDefault(),$.ajax({type:"POST",url:"/api/authorization",data:{email:$("[type = email]").val(),password:$("[type = password]").val()},success:function(a){if($("[class = error]").remove(),1==a.success){var t=a.token;window.localStorage.setItem("access_token",t),window.localStorage.setItem("email",a.user.email),window.localStorage.setItem("username",a.user.username),e.empty(),chat()}else r.before($("<div/>",{"class":"error",text:"Email or Password is incorrect!"}))}})});var n=$("<div/>",{id:"register"}).appendTo(a);$("<h5/>",{text:"Don't have an Account?"}).appendTo(n),$("<button/>",{"class":"btn",click:function(){o.remove(),n.remove();var r=$("<form/>",{}).appendTo(t),s=$("<div/>",{id:"register"}).appendTo(a);$("<input/>").attr({type:"email",required:"true",placeholder:"Email",autocomplete:"off"}).appendTo(r),$("<input/>").attr({type:"password",required:"true",placeholder:"Password",autocomplete:"off"}).appendTo(r),$("<button/>",{"class":"reg",click:function(){$.ajax({type:"POST",url:"/api/registration",data:{email:$("[type = email]").val(),password:$("[type = password]").val(),username:$("[type = text]").val()},success:function(a){if(s.empty(),1==a.success){var t=a.token;window.localStorage.setItem("access_token",t),window.localStorage.setItem("email",a.user.email),window.localStorage.setItem("username",a.user.username),e.empty(),chat()}else $("<h5/>",{text:a.message}).appendTo(s)}})}}).text("Create").appendTo(r),$("[type = email]").before($("<input/>",{type:"text",required:"true",method:"get",placeholder:"Name",autocomplete:"off"})),$("[type = text]").addClass("reg"),$("[type = email]").addClass("reg"),$("[type = password]").addClass("reg"),r.submit(function(e){e.preventDefault()})}}).text("Create Account Now").appendTo(n)};e()});var chat=function(){function e(e){var a=$("<header/>",{"class":"menu"});return $("<h1/>",{text:"Bromo"}).appendTo(a),e.append(a),$("<div/>",{id:"people"}).appendTo(e),this}function a(e){$("<header/>",{"class":"title",text:"Main chat"}).appendTo(e);var a=$("<div/>",{id:"chat"});$("<ul/>",{}).appendTo(a),e.append(a);var r=$("<div/>",{id:"form"});return $("<input/>").attr({id:"message",type:"text",autocomplete:"off"}).appendTo(r),$("<button/>",{text:"Send",click:function(){var e=$("[id = message]").val();e&&(o.emit("message",{message:e,username:n}),t(e,"outbox"),$("[id = message]").val(""))}}).appendTo(r),e.append(r),this}function t(e,a){$("[id = chat]").append($("<li/>",{text:e,"class":a}))}var o=io();o.user={username:n,email:s};var r=[],n=window.localStorage.getItem("username"),s=window.localStorage.getItem("email"),i=$("#page"),p=$("<aside/>",{id:"sidebar"}).appendTo(i),d=$("<div/>",{id:"view"}).appendTo(i);$.ajax({type:"GET",url:"/api/users",headers:{"x-access-token":window.localStorage.getItem("access_token")},success:function(t){console.log(t),1==t.success?(e(p),a(d),r=t.users):(d.append($("<div/>",{"class":"error",text:"Login first, stranger!"})),i.empty(),sign())}}),o.on("message",function(e){var a=e.username+": "+e.message;t(a,"inbox")}),$.unload(function(e){o.close()}),o.on("clear",function(){window.localStorage.removeItem("access_token"),window.localStorage.removeItem("email"),window.localStorage.removeItem("username"),window.location.reload()})};